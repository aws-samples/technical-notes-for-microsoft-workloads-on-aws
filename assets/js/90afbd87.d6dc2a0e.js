"use strict";(self.webpackChunktechnical_notes_for_microsoft_workloads_on_aws=self.webpackChunktechnical_notes_for_microsoft_workloads_on_aws||[]).push([[4448],{1756:(e,o,n)=>{n.d(o,{A:()=>s});const s=n.p+"assets/images/IMG-1-6a55d205e339e49c357dcba16432c402.png"},8330:(e,o,n)=>{n.r(o),n.d(o,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"Desktop Engineering/Guides/Windows LAPS & AWS Microsoft Managed Active Directory/index","title":"Windows LAPS & AWS Microsoft Managed Active Directory","description":"by Luciano Bernardes and Sassan Hajrasooliha","source":"@site/docs/Desktop Engineering/Guides/Windows LAPS & AWS Microsoft Managed Active Directory/index.md","sourceDirName":"Desktop Engineering/Guides/Windows LAPS & AWS Microsoft Managed Active Directory","slug":"/Desktop Engineering/Guides/Windows LAPS & AWS Microsoft Managed Active Directory/","permalink":"/technical-notes-for-microsoft-workloads-on-aws/Desktop Engineering/Guides/Windows LAPS & AWS Microsoft Managed Active Directory/","draft":false,"unlisted":false,"editUrl":"https://github.com/aws-samples/technical-notes-for-microsoft-workloads-on-aws/blob/main/docusaurus/docs/Desktop Engineering/Guides/Windows LAPS & AWS Microsoft Managed Active Directory/index.md","tags":[],"version":"current","sidebarPosition":10,"frontMatter":{"sidebar_position":10,"sidebar_label":"Windows LAPS & AWS Microsoft Managed Active Directory"},"sidebar":"tutorialSidebar","previous":{"title":"Install Q CLI on Windows Subsystem for Linux","permalink":"/technical-notes-for-microsoft-workloads-on-aws/Desktop Engineering/Guides/Install_Q_CLI_for_Windows/"},"next":{"title":".NET","permalink":"/technical-notes-for-microsoft-workloads-on-aws/DotNET/"}}');var i=n(4848),t=n(8453);const r={sidebar_position:10,sidebar_label:"Windows LAPS & AWS Microsoft Managed Active Directory"},a="Windows LAPS & AWS Microsoft Managed Active Directory",d={},c=[{value:"Introduction",id:"introduction",level:3},{value:"Legacy Microsoft LAPS background",id:"legacy-microsoft-laps-background",level:3},{value:"Windows LAPS requirements vs AWS Managed AD design",id:"windows-laps-requirements-vs-aws-managed-ad-design",level:3},{value:"Windows LAPS in legacy Microsoft LAPS emulation mode",id:"windows-laps-in-legacy-microsoft-laps-emulation-mode",level:2},{value:"Conclusion",id:"conclusion",level:2}];function l(e){const o={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",p:"p",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(o.header,{children:(0,i.jsx)(o.h1,{id:"windows-laps--aws-microsoft-managed-active-directory",children:"Windows LAPS & AWS Microsoft Managed Active Directory"})}),"\n",(0,i.jsx)(o.p,{children:"by Luciano Bernardes and Sassan Hajrasooliha"}),"\n",(0,i.jsx)(o.h3,{id:"introduction",children:"Introduction"}),"\n",(0,i.jsxs)(o.p,{children:[(0,i.jsx)(o.a,{href:"https://learn.microsoft.com/en-us/windows-server/identity/laps/laps-overview",children:"Windows Local Administrator Password Solution"})," (Windows LAPS) is a Windows feature that automatically manages and backs up the password of a local administrator account on your Microsoft Entra joined or Windows Server Active Directory-joined devices. You can also use Windows LAPS to automatically manage and back up the Directory Services Restore Mode (DSRM) account password on your Windows Server Active Directory domain controllers (DCs). An authorized administrator can retrieve the DSRM password and use it."]}),"\n",(0,i.jsxs)(o.p,{children:["If you have self-managed Active directory, meaning you are running your domain controllers as Windows EC2 instances on AWS, the ",(0,i.jsx)(o.a,{href:"https://learn.microsoft.com/en-us/windows-server/identity/laps/laps-concepts-overview",children:"considerations and steps"})," to setup LAPS are not different from setting it up on-premises and all features of Windows LAPS are supported provided that your infrastructure meets their minimum requirements. For the remaining of this document we're going to assume that your environment runs with ",(0,i.jsx)(o.a,{href:"https://docs.aws.amazon.com/directoryservice/latest/admin-guide/directory_microsoft_ad.html",children:"AWS Managed Microsoft Active Directory"}),"."]}),"\n",(0,i.jsx)(o.h3,{id:"legacy-microsoft-laps-background",children:"Legacy Microsoft LAPS background"}),"\n",(0,i.jsxs)(o.p,{children:["Before Windows LAPS, Microsoft had provided a legacy version of the solution, often referred as ",(0,i.jsx)(o.em,{children:"legacy Microsoft LAPS"}),". It fully works with AWS Managed AD and you can check more details about its implementation following the ",(0,i.jsx)(o.a,{href:"https://aws.amazon.com/blogs/security/how-to-deploy-local-administrator-password-solution-with-aws-microsoft-ad/",children:"How to Deploy Local Administrator Password Solution with AWS Microsoft AD"})," blog post."]}),"\n",(0,i.jsx)(o.p,{children:"The legacy solution requires a Microsoft LAPS Client Side Extension (CSE) installed on each server and it stores the local administrator password in clear-text in AD database, secured by Active Directory ACLs."}),"\n",(0,i.jsx)(o.h3,{id:"windows-laps-requirements-vs-aws-managed-ad-design",children:"Windows LAPS requirements vs AWS Managed AD design"}),"\n",(0,i.jsx)(o.p,{children:"Aside from the regular clear-text password storage support secured by Active Directory ACLs, Windows LAPS provides enhanced features, such as encrypted password storage support and DSRM password management. It can also leverage either Microsoft Entra ID or Active Directory as the backup directory and integrate with Microsoft Intune."}),"\n",(0,i.jsx)(o.p,{children:"Regarding OS level support, the solution covers Windows Server 2019, 2022, and 2025. Anything older than Windows Server 2019, should rely on the legacy Microsoft LAPS solution."}),"\n",(0,i.jsxs)(o.p,{children:["Having Active Directory as the LAPS password repository and aiming to enable the enhanced features, Windows LAPS requires Domain Functional Level 2016 and domain controllers running on Windows Server 2019 or newer (Image 1). More information ",(0,i.jsx)(o.a,{href:"https://learn.microsoft.com/en-us/windows-server/identity/laps/laps-scenarios-windows-server-active-directory#domain-functional-level-and-domain-controller-os-version-requirements",children:"here"}),"."]}),"\n",(0,i.jsx)(o.p,{children:(0,i.jsx)(o.img,{alt:"IMAGE1",src:n(1756).A+"",width:"863",height:"227"})}),"\n",(0,i.jsx)(o.p,{children:(0,i.jsxs)(o.em,{children:["Image 1 - Table summarizing the supported-or-not scenarios (",(0,i.jsx)(o.a,{href:"https://learn.microsoft.com/en-us/windows-server/identity/laps/laps-scenarios-windows-server-active-directory#domain-functional-level-and-domain-controller-os-version-requirements",children:"from Microsoft docs"}),")"]})}),"\n",(0,i.jsxs)(o.p,{children:["AWS Managed AD currently runs under the Domain and Forest Functional Level 2012 R2 and the domain controllers run on Windows Server 2019. Consequently, the enhanced features are not supported by AWS Managed AD. Check the ",(0,i.jsx)(o.a,{href:"https://docs.aws.amazon.com/directoryservice/latest/admin-guide/ms_ad_getting_started.html",children:"Getting started with AWS Managed Microsoft AD"})," documentation to know more."]}),"\n",(0,i.jsx)(o.h2,{id:"windows-laps-in-legacy-microsoft-laps-emulation-mode",children:"Windows LAPS in legacy Microsoft LAPS emulation mode"}),"\n",(0,i.jsx)(o.p,{children:"Windows LAPS has a feature to be backward-compatible with the legacy LAPS to provide the same feature set like regular clear-text password storage support secured by Active Directory ACLs."}),"\n",(0,i.jsxs)(o.p,{children:["As ",(0,i.jsx)(o.em,{children:"highlighted"})," in ",(0,i.jsx)(o.a,{href:"https://learn.microsoft.com/en-us/windows-server/identity/laps/laps-scenarios-legacy",children:"Get started with Windows LAPS in legacy Microsoft LAPS emulation mode"})," documentation:"]}),"\n",(0,i.jsx)(o.p,{children:(0,i.jsx)(o.em,{children:"You can set up Windows Local Administrator Password Solution (Windows LAPS) to honor legacy Microsoft LAPS Group Policy settings, but with some restrictions and limitations. The feature is called legacy Microsoft LAPS emulation mode. You might use emulation mode if you migrate an existing deployment of legacy Microsoft LAPS to Windows LAPS."})}),"\n",(0,i.jsx)(o.p,{children:"Therefore, considering the current AWS Managed AD underlying architecture, the emulation mode of Windows LAPS is the way to go within AWS Managed AD and it requires the following major steps to have it set up:"}),"\n",(0,i.jsxs)(o.ul,{children:["\n",(0,i.jsxs)(o.li,{children:["\n",(0,i.jsxs)(o.p,{children:["Set up the environment initially following steps 2 to 4 from ",(0,i.jsx)(o.a,{href:"https://aws.amazon.com/blogs/security/how-to-deploy-local-administrator-password-solution-with-aws-microsoft-ad/",children:"legacy Microsoft LAPS setup instructions blog"}),", which are:"]}),"\n",(0,i.jsxs)(o.ul,{children:["\n",(0,i.jsxs)(o.li,{children:["\n",(0,i.jsxs)(o.p,{children:["Extending the schema (step 2). you can check your schema extension file with the ",(0,i.jsx)(o.a,{href:"https://learn.microsoft.com/en-us/windows-server/identity/laps/laps-technical-reference#windows-laps-schema-vs-legacy-microsoft-laps-schema",children:"Legacy Microsoft LAPS schema element table"})," to ensure it has all it needs."]}),"\n"]}),"\n",(0,i.jsxs)(o.li,{children:["\n",(0,i.jsx)(o.p,{children:"Configuring AD permissions (step 3)"}),"\n"]}),"\n",(0,i.jsxs)(o.li,{children:["\n",(0,i.jsx)(o.p,{children:"Configuring LAPS GPO (step 4)"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(o.li,{children:["\n",(0,i.jsxs)(o.p,{children:["(Optional) Install the legacy ",(0,i.jsx)(o.a,{href:"https://www.microsoft.com/en-us/download/details.aspx?id=46899",children:"Microsoft LAPS Client Side Extension (CSE)"})," on Windows Server 2016 or older"]}),"\n"]}),"\n",(0,i.jsxs)(o.li,{children:["\n",(0,i.jsxs)(o.p,{children:[(0,i.jsx)(o.em,{children:"Do not"})," install the legacy Microsoft LAPS Client Side Extension (CSE) on Windows Server 2019 or newer"]}),"\n"]}),"\n",(0,i.jsxs)(o.li,{children:["\n",(0,i.jsxs)(o.p,{children:["(Optional) Use the legacy ",(0,i.jsx)(o.code,{children:"Get-AdmPwdPassword -ComputerName <SERVERNAME>"})," PowerShell cmdlet to retrieve the password when running on Windows Server 2016 or older"]}),"\n"]}),"\n",(0,i.jsxs)(o.li,{children:["\n",(0,i.jsxs)(o.p,{children:["Use the ",(0,i.jsx)(o.code,{children:"Get-LapsADPassword -Identity <SERVERNAME> -AsPlainText"})," PowerShell cmdlet to retrieve the password when running on Windows Server 2019 or newer"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(o.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,i.jsx)(o.p,{children:"Windows LAPS in legacy Microsoft LAPS emulation mode is a supported way to use the solution, considering AWS Managed AD limitations. The benefit is that customers would not have to install the CSE on Windows Server 2019 or newer. From a supportability standpoint, it is currently advisable to utilize the legacy Microsoft LAPS emulation mode when working with AWS Managed Active Directory. This approach provides the balance of functionality and support."})]})}function h(e={}){const{wrapper:o}={...(0,t.R)(),...e.components};return o?(0,i.jsx)(o,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},8453:(e,o,n)=>{n.d(o,{R:()=>r,x:()=>a});var s=n(6540);const i={},t=s.createContext(i);function r(e){const o=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(o):{...o,...e}},[o,e])}function a(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),s.createElement(t.Provider,{value:o},e.children)}}}]);