"use strict";(self.webpackChunktechnical_notes_for_microsoft_workloads_on_aws=self.webpackChunktechnical_notes_for_microsoft_workloads_on_aws||[]).push([[4251],{5059:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/IMAGE01-aaa085a077892cc66245631af716bc59.png"},8453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>a});var t=i(6540);const s={},r=t.createContext(s);function o(e){const n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),t.createElement(r.Provider,{value:n},e.children)}},9067:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"EC2-Windows/Guides/Guide2/index","title":"Windows Server 2003 Migration to Amazon EC2","description":"by Michael Spence","source":"@site/docs/EC2-Windows/Guides/Guide2/index.md","sourceDirName":"EC2-Windows/Guides/Guide2","slug":"/EC2-Windows/Guides/Guide2/","permalink":"/technical-notes-for-microsoft-workloads-on-aws/EC2-Windows/Guides/Guide2/","draft":false,"unlisted":false,"editUrl":"https://github.com/aws-samples/technical-notes-for-microsoft-workloads-on-aws/blob/main/docusaurus/docs/EC2-Windows/Guides/Guide2/index.md","tags":[],"version":"current","sidebarPosition":20,"frontMatter":{"sidebar_position":20},"sidebar":"tutorialSidebar","previous":{"title":"Restrict IAM permission to specific Windows users for AWS Systems Manager","permalink":"/technical-notes-for-microsoft-workloads-on-aws/EC2-Windows/Guides/Guide1/"},"next":{"title":"FAQs","permalink":"/technical-notes-for-microsoft-workloads-on-aws/EC2-Windows/FAQs/"}}');var s=i(4848),r=i(8453);const o={sidebar_position:20},a="Windows Server 2003 Migration to Amazon EC2",l={},d=[{value:"Introduction",id:"introduction",level:3},{value:"AWS VM Import",id:"aws-vm-import",level:3},{value:"Application Migration Service (MGN)",id:"application-migration-service-mgn",level:3}];function c(e){const n={a:"a",code:"code",h1:"h1",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"windows-server-2003-migration-to-amazon-ec2",children:"Windows Server 2003 Migration to Amazon EC2"})}),"\n",(0,s.jsx)(n.p,{children:"by Michael Spence"}),"\n",(0,s.jsx)(n.h3,{id:"introduction",children:"Introduction"}),"\n",(0,s.jsx)(n.p,{children:"I recently had a colleague ask me about migration of a Microsoft Windows Server 2003 virtual machine.  I spent ... so ... many years staring at that UI, I almost felt nostalgic in a way to see if it could still be done. As of the time of writing, Windows Server 2003 is listed as a supported operating system for AWS MGN and it is possible to use VM import to convert the machine from VMware or Hyper-V to EC2.  I thought I would document both approaches below."}),"\n",(0,s.jsx)(n.h3,{id:"aws-vm-import",children:"AWS VM Import"}),"\n",(0,s.jsx)(n.p,{children:"In this approach, we use the AWS VM Import service to convert the virtual machine from Hyper-V to EC2.  Why?   Migration using CloudEndure will require at a minimum .NET 3.5 to be installed on the server.  It is possible that there is a reluctance to install anything on the server itself.  In that case, AWS VM Import is a good path."}),"\n",(0,s.jsxs)(n.p,{children:["Check the following URL for the prerequisites:  ",(0,s.jsx)(n.a,{href:"https://docs.aws.amazon.com/vm-import/latest/userguide/vmie_prereqs.html",children:"https://docs.aws.amazon.com/vm-import/latest/userguide/vmie_prereqs.html"})]}),"\n",(0,s.jsx)(n.p,{children:"Here are the basic steps using a S3 multi-part upload to move the image file into S3 for conversion"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Get the MD5 hash of the image file"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"openssl md5 -binary WS2003.vhdx | base64\n\nXXeDZzPSFcKlIM4JIIpyeQ==\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsx)(n.li,{children:"This particular file was only 2GB but I'm splitting it out into 512MB chunks for illustration purposes."}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"split -b 512m WS2003.vhdx WS2003.vhdx.part-\n"})}),"\n",(0,s.jsx)(n.p,{children:"This will result in WS2003.vhdx-part-aa ... part-ab, etc."}),"\n",(0,s.jsxs)(n.ol,{start:"3",children:["\n",(0,s.jsx)(n.li,{children:"Create the S3 multi-part upload and use the MD5 hash previously generated"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"aws s3api create-multipart-upload \\\n> --bucket sbx-bucket-mhspence \\\n> --key WS2003.vhdx \\\n> --metadata md5=XXeDZzPSFcKlIM4JI\n"})}),"\n",(0,s.jsx)(n.p,{children:"This will return an UploadId"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'{\n    "ServerSideEncryption": "AES256",\n    "Bucket": "<bucket>",\n    "Key": "WS2003.vhdx",\n    "UploadId": "<uploadid>"\n}\n'})}),"\n",(0,s.jsxs)(n.ol,{start:"4",children:["\n",(0,s.jsx)(n.li,{children:"Upload each part of the image file.   I created bash environment variables for the bucket, key, and uploadid."}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"aws s3api upload-part --bucket $bucket --key $key --part-number 1 --body WS2003.vhdx.part-aa --upload-id $upload\n"})}),"\n",(0,s.jsx)(n.p,{children:"This will return an ETag in the response"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'{\n    "ServerSideEncryption": "AES256",\n    "ETag": "\\"f8f6108e716035b4d0e1ef800cd87952\\""\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"Just rinse and repeat for each and every part"}),"\n",(0,s.jsxs)(n.ol,{start:"5",children:["\n",(0,s.jsx)(n.li,{children:"Once all parts have been uploaded complete the multi-part upload.   Create a JSON file that has all the parts in this syntax below so we can put humpty-dumpty back together again."}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'{\n"Parts" : [\n    {\n       "ETag" : "<ETag value>"\n       "PartNumber" : <number>\n    }\n ]\n}\n'})}),"\n",(0,s.jsxs)(n.ol,{start:"6",children:["\n",(0,s.jsx)(n.li,{children:"Complete the S3 multi-part upload"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"aws s3api complete-multipart-upload --multipart-upload file://upload-parts.json --bucket $bucket --key $key --upload-id $uploadid\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"7",children:["\n",(0,s.jsx)(n.li,{children:"Create the VM import image task"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'aws ec2 import-image --disk-containers Format=vhd,UserBucket="{S3Bucket=<bucket>,S3Key=WS2003.vhdx}" --region us-east-1\n'})}),"\n",(0,s.jsx)(n.p,{children:"Once the conversion is complete, launch a new instance from the AMI"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"IMAGE1",src:i(5059).A+"",width:"660",height:"580"})}),"\n",(0,s.jsx)(n.p,{children:"There we go... Windows 2003..."}),"\n",(0,s.jsx)(n.h3,{id:"application-migration-service-mgn",children:"Application Migration Service (MGN)"}),"\n",(0,s.jsxs)(n.p,{children:["I thought it would be prudent to go ahead and run the same migration test with MGN against a Windows 2003 Enterprise R2 x64 virtual machine. Always be sure to check the MGN ",(0,s.jsx)(n.a,{href:"https://docs.aws.amazon.com/mgn/latest/ug/Supported-Operating-Systems.html",children:"Supported Operating Systems"})," for compatibility."]}),"\n",(0,s.jsx)(n.p,{children:"There are a few items to remember:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Microsoft Windows 2003 uses a special version of the AWS Replication agent that is only valid for legacy Windows OSs (AwsReplicationWindowsLegacyInstaller.exe).  That installation file will need to be pulled manually from: ",(0,s.jsx)(n.a,{href:"https://aws-application-migration-service-(region).s3.amazonaws.com/latest/windows_legacy/AwsReplicationWindowsLegacyInstaller.exe",children:"https://aws-application-migration-service-(region).s3.amazonaws.com/latest/windows_legacy/AwsReplicationWindowsLegacyInstaller.exe"})]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Microsoft Windows 2003 (32-bit and 64-bit) requires .Net Framework version 3.5 to be installed by the end user"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"The Nitro instance family can only be used with Windows Server 2008 R2 and upwards, so you will have to use Xen based instances (i.e. t2 series)."}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}}}]);