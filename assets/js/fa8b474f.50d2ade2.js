"use strict";(self.webpackChunktechnical_notes_for_microsoft_workloads_on_aws=self.webpackChunktechnical_notes_for_microsoft_workloads_on_aws||[]).push([[5387],{6713:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>r,contentTitle:()=>l,default:()=>h,frontMatter:()=>s,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"EC2 Windows/Guides/Accelerate_EBS_volume_initialization/index","title":"EBS Provisioned Rate - Accelerate EBS volume initialization","description":"by Craig Cooley","source":"@site/docs/EC2 Windows/Guides/Accelerate_EBS_volume_initialization/index.md","sourceDirName":"EC2 Windows/Guides/Accelerate_EBS_volume_initialization","slug":"/EC2 Windows/Guides/Accelerate_EBS_volume_initialization/","permalink":"/technical-notes-for-microsoft-workloads-on-aws/EC2 Windows/Guides/Accelerate_EBS_volume_initialization/","draft":false,"unlisted":false,"editUrl":"https://github.com/aws-samples/technical-notes-for-microsoft-workloads-on-aws/blob/main/docusaurus/docs/EC2 Windows/Guides/Accelerate_EBS_volume_initialization/index.md","tags":[],"version":"current","sidebarPosition":30,"frontMatter":{"sidebar_position":30,"sidebar_label":"EBS Provisioned Rate - Accelerate EBS volume initialization"},"sidebar":"tutorialSidebar","previous":{"title":"Windows Server 2003 Migration to Amazon EC2","permalink":"/technical-notes-for-microsoft-workloads-on-aws/EC2 Windows/Guides/Windows_Server_2003_Migration_to_Amazon_EC2/"},"next":{"title":"Licensing","permalink":"/technical-notes-for-microsoft-workloads-on-aws/Licensing/"}}');var o=i(4848),a=i(8453);const s={sidebar_position:30,sidebar_label:"EBS Provisioned Rate - Accelerate EBS volume initialization"},l="EBS Provisioned Rate - Accelerate EBS volume initialization",r={},c=[{value:"Introduction",id:"introduction",level:3},{value:"Examples:",id:"examples",level:3}];function d(e){const n={a:"a",code:"code",h1:"h1",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"ebs-provisioned-rate---accelerate-ebs-volume-initialization",children:"EBS Provisioned Rate - Accelerate EBS volume initialization"})}),"\n",(0,o.jsx)(n.p,{children:"by Craig Cooley"}),"\n",(0,o.jsx)(n.h3,{id:"introduction",children:"Introduction"}),"\n",(0,o.jsx)(n.p,{children:"When launching a new EC2 Instance - whether restoring from a backup or creating from an Amazon Machine Image (AMI), the EC2 Instance is launched and accessible after a few minutes.  If an Admin connects via RDP immediately after launch, the instance can seem slow and unresponsive, or the application may not run with the expected performance."}),"\n",(0,o.jsx)(n.p,{children:"When an EBS volume is created from a snapshot (or AMI) the storage blocks are downloaded from S3 to EBS. The EBS volume is available as soon as the initial blocks are downloaded, however it's not fully performant until all blocks are downloaded from S3."}),"\n",(0,o.jsxs)(n.p,{children:["In May 2025, AWS Announced ",(0,o.jsx)(n.a,{href:"https://aws.amazon.com/about-aws/whats-new/2025/05/ebs-provisioned-rate-volume-initialization/",children:"EBS Provisioned Rate for Volume Initialization"})," which  minimizes the amount of time taken to fully restore volumes from S3 to Elastic Block Storage (EBS).  ",(0,o.jsx)(n.a,{href:"https://docs.aws.amazon.com/ebs/latest/userguide/initalize-volume.html#volume-initialization-rate",children:"EBS Provisioned Rate"})," can fully restore the volume at a rate of up to 300 MiB/second to speed this process."]}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.a,{href:"https://docs.aws.amazon.com/sdkfornet/v4/apidocs/items/EC2/TEbsBlockDevice.html",children:"VolumeInitializationRate parameter"})," is relatively low cost (up to $0.00360/GB in us-east-1) and is 'pay per use'."]}),"\n",(0,o.jsx)(n.p,{children:"To demonstrate the increased deployment speed, I added an EC2 User Data Script to install several Windows features when the Instance is launched."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-powershell",children:"Install-WindowsFeature `\n    -Name Failover-Clustering, RSAT-ADDs, RSAT-DNS-Server `\n    -IncludeManagementTools `\n    -IncludeAllSubFeature\n"})}),"\n",(0,o.jsx)(n.p,{children:"When the instance is launched, the optional Windows features are installed from the root volume which is being created.  Normally, when these commands are issued, the blocks are restored from S3 to the EBS volume on demand."}),"\n",(0,o.jsxs)(n.p,{children:["To compare the time to deploy with and without ",(0,o.jsx)(n.strong,{children:"VolumeInitializationRate = 300"}),", I added ",(0,o.jsx)(n.code,{children:"Measure-Command"})," to the script and wrote the time to a local file."]}),"\n",(0,o.jsxs)(n.p,{children:["Here's the command you can run from Cloudshell which creates a new Windows Instance using the ",(0,o.jsx)(n.code,{children:"VolumeInitializationRate = 300"})," parameter to initialize the C: drive at a rate of 300 MiB/second. so the Windows Features will install quickly.  The User Data script measures the amount of time needed to install the ",(0,o.jsx)(n.code,{children:"Failover-Clustering"}),", ",(0,o.jsx)(n.code,{children:"RSAT-ADDs"}),", and ",(0,o.jsx)(n.code,{children:"RSAT-DNS-Server"})," Windows features after the instance boots and records it to a local file."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-powershell",children:'Import-Module AWS.Tools.EC2\nNew-EC2Instance `\n-ImageId "resolve:ssm:/aws/service/ami-windows-latest/TPM-Windows_Server-2025-English-Full-Base" `\n-InstanceType "c7a.xlarge" `\n-Region "us-east-2" `\n-KeyName "<keyname>" `\n-BlockDeviceMapping ( \n    [Amazon.EC2.Model.BlockDeviceMapping]@{\n        DeviceName = \'/dev/sda1\'\n        EBS = [Amazon.EC2.Model.EbsBlockDevice]@{\n            VolumeInitializationRate = 300\n        }\n    }\n) `\n-EncodeUserData `\n-UserData @"\n<powershell>\nMeasure-Command {\n    Install-WindowsFeature ``\n        -Name Failover-Clustering, RSAT-ADDs, RSAT-DNS-Server ``\n        -IncludeManagementTools ``\n        -IncludeAllSubFeature\n} | \nFormat-List TotalMinutes | \nOut-File "C:\\ProgramData\\Amazon\\EC2Launch\\log\\UserDataOutput.txt"\n</powershell>\n"@\n'})}),"\n",(0,o.jsxs)(n.p,{children:["To test without the ",(0,o.jsx)(n.strong,{children:"VolumeInitializationRate = 300"})," parameter, remove the ",(0,o.jsx)(n.code,{children:"-BlockDeviceMapping"})," parameter and compare the time to complete the feature installation by checking the ",(0,o.jsx)(n.code,{children:"C:\\ProgramData\\Amazon\\EC2Launch\\log\\UserDataOutput.txt"})," file saved to the local C: drive."]}),"\n",(0,o.jsx)(n.h3,{id:"examples",children:"Examples:"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"With"})," ",(0,o.jsx)(n.code,{children:"VolumeInitializationRate = 300"})]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"Instance ID: i-abcdef0123456789a   TotalMinutes : 3.24202892666667\nInstance ID: i-abcdef0123456789b   TotalMinutes : 3.280395915\n"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Without"})," ",(0,o.jsx)(n.code,{children:"VolumeInitializationRate = 300"})]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"Instance ID: i-abcdef0123456789c   TotalMinutes : 4.83370798333333\nInstance ID: i-abcdef0123456789d   TotalMinutes : 4.71676925333333\n"})}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"VolumeInitializationRate = 300"})," parameter reduced the time needed to install the Windows Features by about 1 min or 33%."]}),"\n",(0,o.jsx)(n.p,{children:"The EBS Snapshot for Windows 2025 is about 25GB, so given the price of $0.00360/GB. the added cost is a one time charge of $0.09."}),"\n",(0,o.jsx)(n.p,{children:"EBS Provisioned Rate for Volume Initialization can be specified from the following:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"AWS EC2 Console"}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-launch-templates.html",children:"EC2 Launch Template"})}),"\n",(0,o.jsxs)(n.li,{children:["AWS Command line tools (AWS CLI or ",(0,o.jsx)(n.a,{href:"https://docs.aws.amazon.com/powershell/v5/reference/?page=New-EC2Instance.html&tocid=New-EC2Instance",children:"AWS.Tools for PowerShell"}),")"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>s,x:()=>l});var t=i(6540);const o={},a=t.createContext(o);function s(e){const n=t.useContext(a);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);