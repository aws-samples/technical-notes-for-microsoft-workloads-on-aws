"use strict";(self.webpackChunktechnical_notes_for_microsoft_workloads_on_aws=self.webpackChunktechnical_notes_for_microsoft_workloads_on_aws||[]).push([[2146],{16:(e,s,i)=>{i.d(s,{A:()=>n});const n=i.p+"assets/images/Picture2-7532eaef1a3f950c50b875bb00eb8e3e.png"},2950:(e,s,i)=>{i.d(s,{A:()=>n});const n=i.p+"assets/images/Picture3-73ce5322ecf8a078df8a4f973b06976f.png"},3515:(e,s,i)=>{i.d(s,{A:()=>n});const n=i.p+"assets/images/Picture1-4568fbb82d7c04ac930066bff7297b3b.png"},7494:(e,s,i)=>{i.d(s,{A:()=>n});const n=i.p+"assets/images/Picture4-aa04f1c930d7a5308191f7d6367b4c2c.png"},8272:(e,s,i)=>{i.r(s),i.d(s,{assets:()=>c,contentTitle:()=>a,default:()=>u,frontMatter:()=>r,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"EC2-Windows/Guides/Guide1/index","title":"Restrict EC2 IAM role permission to specific Windows users for AWS Systems Manager.","description":"by Siavash Irani","source":"@site/docs/EC2-Windows/Guides/Guide1/index.md","sourceDirName":"EC2-Windows/Guides/Guide1","slug":"/EC2-Windows/Guides/Guide1/","permalink":"/technical-notes-for-microsoft-workloads-on-aws/EC2-Windows/Guides/Guide1/","draft":false,"unlisted":false,"editUrl":"https://github.com/aws-samples/technical-notes-for-microsoft-workloads-on-aws/blob/main/docusaurus/docs/EC2-Windows/Guides/Guide1/index.md","tags":[],"version":"current","sidebarPosition":10,"frontMatter":{"sidebar_position":10,"sidebar_label":"Restrict IAM permission to specific Windows users for AWS Systems Manager"},"sidebar":"tutorialSidebar","previous":{"title":"Guides","permalink":"/technical-notes-for-microsoft-workloads-on-aws/EC2-Windows/Guides/"},"next":{"title":"Windows Server 2003 Migration to Amazon EC2","permalink":"/technical-notes-for-microsoft-workloads-on-aws/EC2-Windows/Guides/Guide2/"}}');var t=i(4848),o=i(8453);const r={sidebar_position:10,sidebar_label:"Restrict IAM permission to specific Windows users for AWS Systems Manager"},a="Restrict EC2 IAM role permission to specific Windows users for AWS Systems Manager.",c={},l=[{value:"Background",id:"background",level:2},{value:"Challenge",id:"challenge",level:2},{value:"Solution",id:"solution",level:2},{value:"Solution diagram",id:"solution-diagram",level:2},{value:"Workflow",id:"workflow",level:2},{value:"Benefits",id:"benefits",level:2},{value:"Potential Cost",id:"potential-cost",level:2}];function d(e){const s={h1:"h1",h2:"h2",header:"header",img:"img",li:"li",ol:"ol",p:"p",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.header,{children:(0,t.jsx)(s.h1,{id:"restrict-ec2-iam-role-permission-to-specific-windows-users-for-aws-systems-manager",children:"Restrict EC2 IAM role permission to specific Windows users for AWS Systems Manager."})}),"\n",(0,t.jsx)(s.p,{children:"by Siavash Irani"}),"\n",(0,t.jsx)("div",{align:"center",children:(0,t.jsx)("iframe",{width:"560",height:"315",src:"https://www.youtube.com/embed/6hJKD4eeScA?si=nMe_jc5dWXwDP44s",title:"YouTube video player",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerpolicy:"strict-origin-when-cross-origin",allowfullscreen:!0})}),"\n",(0,t.jsx)(s.h2,{id:"background",children:"Background"}),"\n",(0,t.jsx)(s.p,{children:"A customer in consulting segment wants to use AWS Systems manager session manager for managing their ec2 instances."}),"\n",(0,t.jsx)(s.h2,{id:"challenge",children:"Challenge"}),"\n",(0,t.jsx)(s.p,{children:"One of the requirement of AWS systems manager is to have an IAM role attached to the instance. This allows ssm-user to interact with AWS using the AWS role permissions. The problem customer had was if they attach an IAM role to the Windows instance, not only it allows ssm-user to interact with AWS, but also any other Windows user which logs in to the instance will have access based on the IAM role."}),"\n",(0,t.jsx)(s.h2,{id:"solution",children:"Solution"}),"\n",(0,t.jsx)(s.p,{children:"The proposed solution was to use Windows firewall to block traffic to IMDS(instance meta-data service) to the specific windows user."}),"\n",(0,t.jsx)(s.h2,{id:"solution-diagram",children:"Solution diagram"}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"Solution diagram",src:i(2950).A+"",width:"743",height:"542"})}),"\n",(0,t.jsx)(s.h2,{id:"workflow",children:"Workflow"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:["Use WF.msc to create a new oubound rule. Add 169.254.169.254 as remote address.\n",(0,t.jsx)(s.img,{alt:"Step1",src:i(3515).A+"",width:"1041",height:"788"})]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:["Block the connection\n",(0,t.jsx)(s.img,{alt:"Step2",src:i(7494).A+"",width:"1058",height:"792"})]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:["Apply the rule to everyone and exclude the rule for other users, like System, ssm-user,administrator.\n",(0,t.jsx)(s.img,{alt:"Step3",src:i(16).A+"",width:"1058",height:"793"})]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"benefits",children:"Benefits"}),"\n",(0,t.jsx)(s.p,{children:"With this method, customer is able to grant permissions to ssm-user and then block access to other Windows users."}),"\n",(0,t.jsx)(s.h2,{id:"potential-cost",children:"Potential Cost"}),"\n",(0,t.jsx)(s.p,{children:"There is no cost to create this solution, it\u2019s just a configuration in windows."})]})}function u(e={}){const{wrapper:s}={...(0,o.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453:(e,s,i)=>{i.d(s,{R:()=>r,x:()=>a});var n=i(6540);const t={},o=n.createContext(t);function r(e){const s=n.useContext(o);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),n.createElement(o.Provider,{value:s},e.children)}}}]);