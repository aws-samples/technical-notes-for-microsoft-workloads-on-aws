<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-SQL-Server/Guides/Guide1/index" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Scripted prerequisites check for integrating Amazon RDS for SQL Server with self-managed Active Directory | Technical Notes for Microsoft Workloads on AWS</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://aws-samples.github.io/technical-notes-for-microsoft-workloads-on-aws/SQL-Server/Guides/Guide1/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Scripted prerequisites check for integrating Amazon RDS for SQL Server with self-managed Active Directory | Technical Notes for Microsoft Workloads on AWS"><meta data-rh="true" name="description" content="by Ben Groeneveld"><meta data-rh="true" property="og:description" content="by Ben Groeneveld"><link data-rh="true" rel="icon" href="/technical-notes-for-microsoft-workloads-on-aws/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://aws-samples.github.io/technical-notes-for-microsoft-workloads-on-aws/SQL-Server/Guides/Guide1/"><link data-rh="true" rel="alternate" href="https://aws-samples.github.io/technical-notes-for-microsoft-workloads-on-aws/SQL-Server/Guides/Guide1/" hreflang="en"><link data-rh="true" rel="alternate" href="https://aws-samples.github.io/technical-notes-for-microsoft-workloads-on-aws/SQL-Server/Guides/Guide1/" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/technical-notes-for-microsoft-workloads-on-aws/blog/rss.xml" title="Technical Notes for Microsoft Workloads on AWS RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/technical-notes-for-microsoft-workloads-on-aws/blog/atom.xml" title="Technical Notes for Microsoft Workloads on AWS Atom Feed"><link rel="stylesheet" href="/technical-notes-for-microsoft-workloads-on-aws/assets/css/styles.7e004171.css">
<script src="/technical-notes-for-microsoft-workloads-on-aws/assets/js/runtime~main.652e754f.js" defer="defer"></script>
<script src="/technical-notes-for-microsoft-workloads-on-aws/assets/js/main.bb929a21.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/technical-notes-for-microsoft-workloads-on-aws/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/technical-notes-for-microsoft-workloads-on-aws/"><div class="navbar__logo"><img src="/technical-notes-for-microsoft-workloads-on-aws/img/logo.svg" alt="AWS Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/technical-notes-for-microsoft-workloads-on-aws/img/logo.svg" alt="AWS Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Technical Notes for Microsoft Workloads on AWS</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/technical-notes-for-microsoft-workloads-on-aws/home">Home</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/technical-notes-for-microsoft-workloads-on-aws/DotNET/Guides/">.NET</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/technical-notes-for-microsoft-workloads-on-aws/Active-Directory/Guides/">Active Directory</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/technical-notes-for-microsoft-workloads-on-aws/Windows-Containers/Guides/">Windows Containers</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/technical-notes-for-microsoft-workloads-on-aws/SQL-Server/Guides/">SQL Server</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/technical-notes-for-microsoft-workloads-on-aws/EC2-Windows/Guides/">EC2 Windows</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/technical-notes-for-microsoft-workloads-on-aws/Licensing/Guides/">Licensing</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/aws-samples/technical-notes-for-microsoft-workloads-on-aws" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input searchInput_YFbd" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/technical-notes-for-microsoft-workloads-on-aws/home">About Technical Notes for Microsoft Workloads on AWS</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/technical-notes-for-microsoft-workloads-on-aws/DotNET/">.NET</a><button aria-label="Expand sidebar category &#x27;.NET&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/technical-notes-for-microsoft-workloads-on-aws/Active-Directory/">Active Directory</a><button aria-label="Expand sidebar category &#x27;Active Directory&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/technical-notes-for-microsoft-workloads-on-aws/Windows-Containers/">Windows Containers</a><button aria-label="Expand sidebar category &#x27;Windows Containers&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/technical-notes-for-microsoft-workloads-on-aws/SQL-Server/">SQL Server</a><button aria-label="Collapse sidebar category &#x27;SQL Server&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/technical-notes-for-microsoft-workloads-on-aws/SQL-Server/Guides/">Guides</a><button aria-label="Collapse sidebar category &#x27;Guides&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/technical-notes-for-microsoft-workloads-on-aws/SQL-Server/Guides/Guide1/">Amazon RDS for SQL Server with self-managed Active Directory</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/technical-notes-for-microsoft-workloads-on-aws/SQL-Server/FAQs/">FAQs</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/technical-notes-for-microsoft-workloads-on-aws/EC2-Windows/">EC2 Windows</a><button aria-label="Expand sidebar category &#x27;EC2 Windows&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/technical-notes-for-microsoft-workloads-on-aws/Licensing/">Licensing</a><button aria-label="Expand sidebar category &#x27;Licensing&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/technical-notes-for-microsoft-workloads-on-aws/Workshops">Workshops</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/technical-notes-for-microsoft-workloads-on-aws/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/technical-notes-for-microsoft-workloads-on-aws/SQL-Server/"><span itemprop="name">SQL Server</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/technical-notes-for-microsoft-workloads-on-aws/SQL-Server/Guides/"><span itemprop="name">Guides</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Amazon RDS for SQL Server with self-managed Active Directory</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Scripted prerequisites check for integrating Amazon RDS for SQL Server with self-managed Active Directory</h1></header>
<p>by Ben Groeneveld</p>
<p>For customers aiming to deploy RDS for SQL Server and integrate it with a self-managed Active Directory for Windows Authentication, it&#x27;s crucial to ensure that all key prerequisites are met before initiating the provisioning of the RDS instance.</p>
<p>To make things easier, I have created the following scripts that can assist with this validation as well as assist with troubleshooting efforts for customers who are running into issues during deployment.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="network">Network<a href="#network" class="hash-link" aria-label="Direct link to Network" title="Direct link to Network">​</a></h2>
<p>Make sure that you have met the following network configurations:</p>
<ul>
<li>
<p>Connectivity configured between the Amazon VPC where you want to create the RDS for SQL Server DB instance and your self-managed Active Directory. You can set up connectivity using AWS Direct Connect, AWS VPN, VPC peering, or AWS Transit Gateway.</p>
</li>
<li>
<p>For VPC security groups, the default security group for your default Amazon VPC is already added to your RDS for SQL Server DB instance in the console. Ensure that the security group and the VPC network ACLs for the subnet(s) where you&#x27;re creating your RDS for SQL Server DB instance allow traffic on the ports and in the directions shown in the following diagram.</p>
</li>
</ul>
<p><img decoding="async" loading="lazy" alt="IMAGE1" src="/technical-notes-for-microsoft-workloads-on-aws/assets/images/IMG01-1db2ecb9deb1595f3c8a2498c1295309.png" width="606" height="303" class="img_ev3q"></p>
<p>The following table identifies the role of each port.</p>
<table><thead><tr><th>Protocol</th><th style="text-align:center">Ports</th><th style="text-align:center">Role</th></tr></thead><tbody><tr><td>TCP/UDP</td><td style="text-align:center">53</td><td style="text-align:center">Domain Name System (DNS)</td></tr><tr><td>TCP/UDP</td><td style="text-align:center">88</td><td style="text-align:center">Kerberos authentication</td></tr><tr><td>TCP/UDP</td><td style="text-align:center">464</td><td style="text-align:center">Change/Set password</td></tr><tr><td>TCP/UDP</td><td style="text-align:center">389</td><td style="text-align:center">Lightweight Directory Access Protocol (LDAP)</td></tr><tr><td>TCP</td><td style="text-align:center">135</td><td style="text-align:center">Distributed Computing Environment / End Point Mapper (DCE / EPMAP)</td></tr><tr><td>TCP</td><td style="text-align:center">445</td><td style="text-align:center">Directory Services SMB file sharing</td></tr><tr><td>TCP</td><td style="text-align:center">636</td><td style="text-align:center">Lightweight Directory Access Protocol over TLS/SSL (LDAPS)</td></tr><tr><td>TCP</td><td style="text-align:center">49152 - 65535</td><td style="text-align:center">Ephemeral ports for RPC</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="input">INPUT<a href="#input" class="hash-link" aria-label="Direct link to INPUT" title="Direct link to INPUT">​</a></h2>
<p>The following PowerShell script will verify the necessary network ports. For accuracy, run the script from a Windows instance located in the same VPC and subnet where you plan to deploy the RDS instance.</p>
<p>The TCP test will tell you whether the port is open or closed.</p>
<p>The UDP test will merely try to send a packet to the port. If there&#x27;s no error on sending, it&#x27;ll tell you the packet was sent. This doesn&#x27;t mean the port is open and listening; it just means the packet was sent without any error on the client&#x27;s end. UDP is connectionless, and as such, doesn&#x27;t offer as clear a test for connectivity as TCP.</p>
<blockquote>
<p>Do note, the script does not test TCP ports 49152 – 65535 (Ephemeral ports for RPC).</p>
</blockquote>
<blockquote>
<p>Important: Replace &quot;$ip&quot; with the IP address to check connectivity.</p>
</blockquote>
<blockquote>
<p>Ensure you run the PowerShell script with elevated permissions.</p>
</blockquote>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Define the target IP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ip = &quot;10.39.233.12&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Define the ports to test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ports = @(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @{ Protocol = &quot;TCP&quot;; Port = 53; },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @{ Protocol = &quot;UDP&quot;; Port = 53; },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @{ Protocol = &quot;TCP&quot;; Port = 88; },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @{ Protocol = &quot;UDP&quot;; Port = 88; },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @{ Protocol = &quot;TCP&quot;; Port = 464; },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @{ Protocol = &quot;UDP&quot;; Port = 464; },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @{ Protocol = &quot;TCP&quot;; Port = 389; },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @{ Protocol = &quot;UDP&quot;; Port = 389; },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @{ Protocol = &quot;TCP&quot;; Port = 135; },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @{ Protocol = &quot;TCP&quot;; Port = 445; },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @{ Protocol = &quot;TCP&quot;; Port = 636; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foreach ($entry in $ports) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $port = $entry.Port</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $protocol = $entry.Protocol</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if ($protocol -eq &quot;TCP&quot;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Testing TCP port using Test-NetConnection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $result = Test-NetConnection -ComputerName $ip -Port $port -InformationLevel Quiet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if ($result) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Write-Host &quot;TCP port $port is open on $ip&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Write-Host &quot;TCP port $port is closed on $ip&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } elseif ($protocol -eq &quot;UDP&quot;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Testing UDP port (this method only checks if it can send without error, not if the packet is received)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            $udpClient = New-Object System.Net.Sockets.UdpClient</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            $udpClient.Connect($ip, $port)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            $udpClient.Send([byte[]](1..4), 4) | Out-Null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            $udpClient.Close()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Write-Host &quot;UDP packet sent to port $port on $ip&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Write-Host &quot;Failed to send UDP packet to port $port on $ip - $_&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="active-directory-organisational-unit">Active Directory Organisational Unit<a href="#active-directory-organisational-unit" class="hash-link" aria-label="Direct link to Active Directory Organisational Unit" title="Direct link to Active Directory Organisational Unit">​</a></h2>
<p>The below PowerShell script can be used to validate that the OU they intend to use is valid. Run this script in a PowerShell session with the necessary permissions to read objects in Active Directory, and it will tell you whether the given OU exists or not.</p>
<blockquote>
<p>First, ensure you have the ActiveDirectory module installed. If it&#x27;s not installed, you can get it by installing the Remote Server Administration Tools (RSAT) or by using Install-WindowsFeature.</p>
<p>Important: Replace &quot;$ouPathToCheck&quot; with the desired OU path.</p>
</blockquote>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Import the ActiveDirectory module</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Import-Module ActiveDirectory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Function to validate OU path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function Validate-OUPath {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    param (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        [Parameter(Mandatory=$true)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        [string]$OUPath</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Try to get the OU from the provided path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $ou = Get-ADOrganizationalUnit -Identity $OUPath -ErrorAction Stop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # If the above command doesn&#x27;t throw an error, the OU exists</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Write-Output &quot;OU exists!&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } catch {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # If there&#x27;s an error, the OU probably doesn&#x27;t exist or there&#x27;s a permission issue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Write-Output &quot;OU does not exist or there was an error checking. Details: $_&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Your OU path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ouPathToCheck = &quot;OU=RDS,OU=test,DC=test,DC=local&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Validate the provided OU path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Validate-OUPath -OUPath $ouPathToCheck</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/aws-samples/technical-notes-for-microsoft-workloads-on-aws/blob/main/docusaurus/docs/SQL-Server/Guides/Guide1/index.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/technical-notes-for-microsoft-workloads-on-aws/SQL-Server/Guides/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Guides</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/technical-notes-for-microsoft-workloads-on-aws/SQL-Server/FAQs/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">FAQs</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#network" class="table-of-contents__link toc-highlight">Network</a></li><li><a href="#input" class="table-of-contents__link toc-highlight">INPUT</a></li><li><a href="#active-directory-organisational-unit" class="table-of-contents__link toc-highlight">Active Directory Organisational Unit</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Built with ❤️ at AWS. <br> © 2025.  Amazon.com, Inc. or its affiliates. All Rights Reserved.</div></div></div></footer></div>
</body>
</html>